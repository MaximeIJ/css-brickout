var M=Object.defineProperty;var P=(l,e,t)=>e in l?M(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var a=(l,e,t)=>(P(l,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class p{constructor({parent:e,elementId:t,className:i,x:s,y:n,width:o=0,height:d=0}){a(this,"x");a(this,"y");a(this,"width");a(this,"height");a(this,"element");a(this,"parent");this.x=s,this.y=n,this.width=o,this.height=d,this.parent=e,this.element=document.createElement("div"),this.element.id=t,o&&(this.element.style.width=`${o}%`),d&&(this.element.style.height=`${d}%`),i&&this.element.classList.add(i),e.appendChild(this.element),this.updateElementPosition()}updatePosition(e,t){this.x=e??this.x,this.y=t??this.y}updateElementPosition(){const{offsetWidth:e,offsetHeight:t}=this.parent,i=Math.round(this.x/100*e),s=Math.round(this.y/100*t);this.element.style.transform=`translateX(calc(${i}px - 50%)) translateY(calc(${s}px - 50%))`}setStyle(e,t){this.element.style[e]=t}setContent(e){this.element.innerHTML=e}destroy(){this.element.remove()}}class x extends p{constructor({idx:t,radius:i,angle:s,speed:n,...o}){super({...o,className:[...o.className??[],"ball"].join(" "),elementId:`ball-${t}`});a(this,"destroyed",!1);a(this,"radius");a(this,"speed");a(this,"angle");this.radius=i,this.angle=s,this.speed=n;const d=Math.round(this.radius/100*this.parent.offsetHeight);this.element.style.setProperty("--diameter",d*2+"px")}updatePosition(){super.updatePosition(this.x+this.speed*Math.cos(this.angle),this.y-this.speed*Math.sin(this.angle))}handleLevelCollision(t,i){const s=this.handleBoundaryCollision(t);let n=!1,o=0;for(;o<t.bricks.length&&!n;){let d=0;for(;d<t.bricks[o].length&&!n;){const h=t.bricks[o][d];if(d++,!h.destroyed&&this.isColliding(h)){n=!0;const r=h.x+h.width/2-this.x,m=h.y-h.height/2-this.y;console.log("deltaX",r,"deltaY",m);const c=Math.abs(h.x-(this.x+this.radius)),u=Math.abs(h.x+h.width-(this.x+this.radius)),g=Math.abs(h.y-(this.y+this.radius)),f=Math.abs(h.y+h.height-(this.y+this.radius)),b=this.x,v=this.y,y=this.angle;Math.min(c,u)>Math.min(g,f)?(console.log("side hit brick",h.y,h.x,f,g,c,u),this.angle=Math.atan2(this.speed*Math.sin(this.angle),-this.speed*Math.cos(this.angle)),this.updatePosition(),this.isColliding(h)&&(console.warn("side hit was wrong, switching to vertical",this.angle),this.angle=Math.atan2(-this.speed*Math.sin(y),this.speed*Math.cos(y))),this.x=b,this.y=v):(console.log("vert hit brick",h.y,h.x,f,g,c,u),this.angle=Math.atan2(-this.speed*Math.sin(this.angle),this.speed*Math.cos(this.angle)),this.updatePosition(),this.isColliding(h)&&(console.warn("vertical hit was wrong, switching to side",this.angle),this.angle=Math.atan2(this.speed*Math.sin(y),-this.speed*Math.cos(y))),this.x=b,this.y=v),h.destroy(),t.onBrickDestroyed(h)}}o++}n||s||this.handlePaddleCollision(i),this.updatePosition(),this.updateElementPosition()}handleBoundaryCollision(t){if(this.x-this.radius<=0||this.x+this.radius>=100)return this.angle=Math.PI-this.angle,!0;if(this.y-this.radius<=0)return this.angle=-this.angle,!0;if(this.y+this.radius>=100)return this.speed/=1.5,this.destroy(),t.onBallLost(),!0}handlePaddleCollision(t){const i=t.y-t.height/2;if(this.isColliding(t)){const n=(this.x-t.x)/(t.width/2),o=this.angle,h=n*.4,r=-(o+h);return this.y=i-this.radius,this.angle=r,!0}}isColliding(t){const i=t.y-t.height/2,s=t.y+t.height/2,n=t.x-t.width/2,o=t.x+t.width/2;return this.x+this.radius>n&&this.x-this.radius<o&&this.y+this.radius>i&&this.y-this.radius<s}destroy(){setTimeout(()=>{super.destroy()},350),this.element.classList.add("ball--destroyed"),this.destroyed=!0}}class L extends p{constructor({elementId:e="debug",x:t=4,y:i=97,...s}){super({elementId:e,x:t,y:i,...s})}}class E extends p{constructor(t){super({...t,className:[...t.className??[],"brick"].join(" ")});a(this,"destroyed",!1)}destroy(){setTimeout(()=>{super.destroy()},300),this.element.classList.add("brick--destroyed"),this.destroyed=!0}}class C{constructor({cols:e,height:t,rows:i,y:s,parent:n,onBallLost:o,onBrickDestroyed:d}){a(this,"bricks");a(this,"left");a(this,"onBallLost");a(this,"onBrickDestroyed");this.bricks=[];let h=0;for(let r=0;r<i;r++){const m=[],c=100/e;for(let u=0;u<e;u++)m.push(new E({parent:n,width:c,height:t,x:c*(u+.5),y:s+t*r,elementId:`brick-${r*e+u}`})),h++;this.bricks.push(m)}this.left=h,this.onBallLost=o,this.onBrickDestroyed=r=>{this.left--,d(r)}}isDone(){return this.left===0}}class B extends p{constructor(e){super({...e,className:[...e.className??[],"paddle"].join(" ")}),this.parent.addEventListener("mousemove",t=>this.handleMouseMove(t)),this.parent.addEventListener("touchmove",t=>this.handleTouchMove(t),{passive:!0})}handleMouseMove(e){const i=e.clientX/this.parent.offsetWidth*100;this.updatePosition(i)}handleTouchMove(e){const s=e.touches[0].clientX/window.innerWidth*100;this.updatePosition(s)}destroy(){this.parent.removeEventListener("mouseover",e=>this.handleMouseMove(e)),this.parent.removeEventListener("touchmove",e=>this.handleTouchMove(e)),super.destroy()}}class k extends p{constructor({elementId:e="pause",x:t=50,y:i=50,...s}){super({elementId:e,x:t,y:i,...s})}}const w=["playing","debug"],T=["paused","away"];class D{constructor(e){a(this,"element");a(this,"state","starting");a(this,"lastFrameTime",Date.now());a(this,"lastFpsUpdate",Date.now());a(this,"balls",[]);a(this,"level");a(this,"paddle");a(this,"debug");a(this,"paused");a(this,"debounceTimer");this.element=document.getElementById(e.parentId??"game"),this.paddle=new B({...e.paddleConfig,parent:this.element,elementId:"paddle",x:50,y:89}),this.debug=null,this.paused=null,this.level=new C({...e.levelConfig,parent:this.element,onBallLost:()=>this.onBallLost(),onBrickDestroyed:t=>this.onBrickDestroyed(t)}),e.ballConfigs.forEach((t,i)=>{const s=new x({...t,idx:i,parent:this.element});this.balls.push(s)}),document.addEventListener("visibilitychange",()=>this.handleVisibilityChange()),document.addEventListener("keydown",t=>this.handleKeyPress(t)),this.element.addEventListener("mouseenter",()=>this.handleMouseEnter()),this.element.addEventListener("mouseleave",()=>this.handleMouseLeave())}debounce(e,t=500){return()=>{clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{e.apply(this)},t)}}start(){this.createdPausedElement("SPACE to start")}update(){if(w.includes(this.state)){this.debug&&this.updateDebug(),this.paddle.updateElementPosition();for(const e of this.balls)if(e.handleLevelCollision(this.level,this.paddle),this.debug&&e.y>this.paddle.y-this.paddle.height&&e.y<this.paddle.y){console.log(e.element.id+" is near paddle");const t=Math.round(e.x-this.paddle.width/2+Math.random()*this.paddle.width/2);this.paddle.updatePosition(t)}requestAnimationFrame(()=>this.update())}}onBallLost(){this.balls=this.balls.filter(e=>!e.destroyed),this.balls.length===0&&(this.state="lost",this.createdPausedElement("Game Over","final"))}onBrickDestroyed(e){this.level.isDone()&&(this.state="won",this.createdPausedElement("Victory!","final"))}updateDebug(){var i;const e=Date.now(),t=1e3/(e-this.lastFrameTime);this.lastFrameTime=e,e>this.lastFpsUpdate+1e3&&((i=this.debug)==null||i.setContent(`FPS: ${t.toFixed(0)} | ${this.state}`),this.lastFpsUpdate=e)}handleVisibilityChange(){document.hidden?(this.pause(),this.state="away"):this.resume()}handleKeyPress(e){switch(e.code){case"KeyP":case"Space":this.state==="starting"?this.resume("starting"):this.paused?this.resume():this.pause();break;case"KeyD":this.debug?(this.debug.destroy(),this.debug=null,this.state==="debug"&&(this.state="playing")):(this.debug=new L({parent:this.element}),this.state="debug");break}}handleMouseEnter(){this.debounceTimer&&this.debounce(()=>this.resume("away"),1e3)()}handleMouseLeave(){this.debounce(()=>{this.pause("away")})()}createdPausedElement(e,t=""){var i;(i=this.paused)==null||i.destroy(),this.paused=new k({parent:this.element,className:t}),this.paused.setContent(e)}pause(e){var t;w.includes(this.state)&&(this.createdPausedElement(e==="away"?"Away":`Paused 
(SPACE to resume)`),this.state=e??"paused",(t=this.debug)==null||t.setContent(this.state))}resume(e){var t;(e?e===this.state:T.includes(this.state))&&((t=this.paused)==null||t.destroy(),this.paused=null,this.state=this.debug?"debug":"playing",this.update())}destroy(){document.removeEventListener("visibilitychange",()=>this.handleVisibilityChange()),document.removeEventListener("keydown",e=>this.handleKeyPress(e)),this.element.removeEventListener("mouseenter",()=>this.handleMouseEnter()),this.element.removeEventListener("mouseleave",()=>this.handleMouseLeave())}}const X=-Math.PI/2.001,A={x:50,y:35,radius:.5,speed:.45},F={ballConfigs:[{...A,angle:X}],levelConfig:{y:10,rows:4,cols:20,height:3},paddleConfig:{width:8.9,height:1}},N=new D(F);N.start();
